schema: '2.0'
stages:
  preprocess:
    cmd: python src/preprocess.py
    deps:
    - path: data/raw/household_power_consumption_hourly.csv
      hash: md5
      md5: 4966a039db50b9d65348281aa9284f74
      size: 4256472
    - path: src/preprocess.py
      hash: md5
      md5: 2d5e7354b6af7c0dd836a2e408466703
      size: 3302
    params:
      params.yaml:
        preprocess:
          target_column: Global_active_power
          test_split_ratio: 0.2
        train.features:
        - Global_reactive_power
        - Voltage
        - Global_intensity
        - Sub_metering_1
        - Sub_metering_2
        - Sub_metering_3
        - hour_of_day
        - day_of_week
        - month
        - year
    outs:
    - path: data/processed
      hash: md5
      md5: fbc47970798131997c5e76b2907928c8.dir
      size: 4935101
      nfiles: 4
  split:
    cmd: python src/data_split.py
    deps:
    - path: data/processed/cleaned_data.csv
      hash: md5
      md5: a65140f8a2704a77015b0d5cc16bf05e
      size: 115279892
    - path: src/data_split.py
      hash: md5
      md5: 1f31c47747187b3b3b2afb250f6e5f5f
      size: 3067
    params:
      params.yaml:
        base:
          project_name: energy_consumption_prediction
          random_state: 42
        data:
          raw_data_dir: data/raw
          raw_data_file: household_power_consumption.txt
          processed_data_dir: data/processed
          cleaned_file: cleaned_data.csv
          train_file: train.csv
          test_file: test.csv
        data_split:
          test_split_ratio: 0.2
        featurization:
          features_to_use:
          - Global_reactive_power
          - Voltage
          - Global_intensity
          - Sub_metering_1
          - Sub_metering_2
          - Sub_metering_3
        preprocessing:
          separator: ;
          missing_value_char: '?'
          target_col: Global_active_power
          imputation_method: ffill
    outs:
    - path: data/processed/test.csv
      hash: md5
      md5: be211a85e7a466889ad83a8bc432fc12
      size: 23055908
    - path: data/processed/train.csv
      hash: md5
      md5: e30b66abcdd7571113dfeaee7cc09529
      size: 92224106
  train_model:
    cmd: python src/train.py
    deps:
    - path: data/processed/train.csv
      hash: md5
      md5: d6efe250686db1a2d1071b65fc978c0d
      size: 92243702
    - path: src/train.py
      hash: md5
      md5: c7df8b34f7170f72dde8cfff32fa5f6d
      size: 4373
    params:
      params.yaml:
        base:
          project_name: energy_consumption_prediction
          random_state: 42
        data:
          raw_data_dir: data/raw
          raw_data_file: household_power_consumption.txt
          processed_data_dir: data/processed
          cleaned_file: cleaned_data.csv
          train_file: train.csv
          test_file: test.csv
        featurization:
          features_to_use:
          - Global_reactive_power
          - Voltage
          - Global_intensity
          - Sub_metering_1
          - Sub_metering_2
          - Sub_metering_3
        model:
          model_name: XGBoostRegressor
          n_estimators: 100
          max_depth: 6
          learning_rate: 0.1
          min_child_weight: 1
          subsample: 0.8
          colsample_bytree: 0.8
        preprocessing:
          separator: ;
          missing_value_char: '?'
          target_col: Global_active_power
          imputation_method: bfill
        tuning:
          cv_folds: 5
          n_iter: 100
          param_distributions:
            model.n_estimators:
            - 100
            - 200
            - 300
            - 400
            - 500
            model.max_depth:
            - 4
            - 6
            - 8
            - 10
            - 12
            model.learning_rate:
            - 0.01
            - 0.05
            - 0.1
            - 0.2
            - 0.3
            model.min_child_weight:
            - 1
            - 5
            - 10
            model.subsample:
            - 0.6
            - 0.7
            - 0.8
            - 0.9
            - 1.0
            model.colsample_bytree:
            - 0.6
            - 0.7
            - 0.8
            - 0.9
            - 1.0
            model.reg_alpha:
            - 0
            - 0.01
            - 0.1
            - 1
            model.reg_lambda:
            - 1
            - 1.5
            - 2
            - 3
            - 4
            model.gamma:
            - 0
            - 0.1
            - 0.2
            - 0.3
            - 0.4
    outs:
    - path: models/model.joblib
      hash: md5
      md5: 20247991fc54326d9b0351f5c1f608c3
      size: 498558
  evaluate_model:
    cmd: python src/evaluate.py
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 9e2bf364f1f516d8d4ed9fe89ca6f5a1
      size: 23060884
    - path: models/model.joblib
      hash: md5
      md5: 20247991fc54326d9b0351f5c1f608c3
      size: 498558
    - path: src/evaluate.py
      hash: md5
      md5: 928231352f9f1ff78b41e4165b989f71
      size: 3875
    params:
      params.yaml:
        base:
          project_name: energy_consumption_prediction
          random_state: 42
        data:
          raw_data_dir: data/raw
          raw_data_file: household_power_consumption.txt
          processed_data_dir: data/processed
          cleaned_file: cleaned_data.csv
          train_file: train.csv
          test_file: test.csv
        featurization:
          features_to_use:
          - Global_reactive_power
          - Voltage
          - Global_intensity
          - Sub_metering_1
          - Sub_metering_2
          - Sub_metering_3
        preprocessing:
          separator: ;
          missing_value_char: '?'
          target_col: Global_active_power
          imputation_method: bfill
    outs:
    - path: reports/metrics.json
      hash: md5
      md5: 212a0b1faa16f0b1307e43d1e5e43b1b
      size: 166
  train:
    cmd: python src/train.py
    deps:
    - path: data/processed/X_train.csv
      hash: md5
      md5: bb17cc02d10b3c1f0d20ff2b072d6488
      size: 3199102
    - path: data/processed/y_train.csv
      hash: md5
      md5: 430912096fed0c3ec8a877f46535b381
      size: 1006246
    - path: src/train.py
      hash: md5
      md5: 6c6ec71e7578db6875acc844539d3ddc
      size: 3484
    params:
      params.yaml:
        preprocess.target_column: Global_active_power
        train.model.name: RandomForestRegressor
        train.model.params.colsample_bytree: 1.0
        train.model.params.gamma: 0.0
        train.model.params.learning_rate: 0.1
        train.model.params.max_depth:
        train.model.params.max_features: 1.0
        train.model.params.min_child_weight: 1
        train.model.params.min_samples_leaf: 2
        train.model.params.min_samples_split: 5
        train.model.params.n_estimators: 150
        train.model.params.random_state: 42
        train.model.params.reg_alpha: 0.0
        train.model.params.subsample: 1.0
    outs:
    - path: models/model.pkl
      hash: md5
      md5: d0779f86f12007cafd1bb936e52ede8c
      size: 133698081
  evaluate:
    cmd: python src/evaluate.py
    deps:
    - path: data/processed/X_test.csv
      hash: md5
      md5: 31f54f03208709fc03213305add4c35b
      size: 802693
    - path: data/processed/y_test.csv
      hash: md5
      md5: 02372a9c716df4a782bbb4ece6664366
      size: 249975
    - path: models/model.pkl
      hash: md5
      md5: d0779f86f12007cafd1bb936e52ede8c
      size: 133698081
    - path: src/evaluate.py
      hash: md5
      md5: 26c5232fda648c936a9475c466f1bf36
      size: 2800
    params:
      params.yaml:
        preprocess.target_column: Global_active_power
    outs:
    - path: metrics/metrics.json
      hash: md5
      md5: b876cee2e251cab100cfa7242ed4e440
      size: 109
  train@0:
    cmd: python src/train.py --model-name "XGBoostRegressor"
    deps:
    - path: data/processed
      hash: md5
      md5: fbc47970798131997c5e76b2907928c8.dir
      size: 4935101
      nfiles: 4
    - path: src/train.py
      hash: md5
      md5: efd1a619ac59fbb1efe8a2a5b87cd117
      size: 4257
    params:
      params.yaml:
        train.features:
        - Global_reactive_power
        - Voltage
        - Global_intensity
        - Sub_metering_1
        - Sub_metering_2
        - Sub_metering_3
        - hour_of_day
        - day_of_week
        - month
        - year
        train.models:
        - name: XGBoostRegressor
          file_name: xgb_model.pkl
          params:
            objective: reg:squarederror
            n_estimators: 1000
            learning_rate: 0.05
            max_depth: 6
            min_child_weight: 1
            gamma: 0.1
            reg_alpha: 0.005
            reg_lambda: 1
            subsample: 0.8
            colsample_bytree: 0.8
            random_state: 42
        - name: RandomForestRegressor
          file_name: rf_model.pkl
          params:
            n_estimators: 200
            max_depth: 15
            min_samples_split: 5
            min_samples_leaf: 2
            max_features: sqrt
            bootstrap: true
            oob_score: true
            random_state: 42
            n_jobs: -1
        - name: LightGBMRegressor
          file_name: lgbm_model.pkl
          params:
            boosting_type: gbdt
            objective: regression_l1
            n_estimators: 1000
            learning_rate: 0.05
            num_leaves: 31
            max_depth: -1
            reg_alpha: 0.1
            reg_lambda: 0.1
            colsample_bytree: 0.8
            subsample: 0.8
            random_state: 42
            n_jobs: -1
        validation:
          run_tcv: true
          tcv_splits: 5
          plots_dir: metrics/validation_plots
    outs:
    - path: models/xgb_model.pkl
      hash: md5
      md5: 1f3fb066cbe1c95d90bc0946cb196aea
      size: 1003820
  train@1:
    cmd: python src/train.py --model-name "RandomForestRegressor"
    deps:
    - path: data/processed
      hash: md5
      md5: fbc47970798131997c5e76b2907928c8.dir
      size: 4935101
      nfiles: 4
    - path: src/train.py
      hash: md5
      md5: efd1a619ac59fbb1efe8a2a5b87cd117
      size: 4257
    params:
      params.yaml:
        train.features:
        - Global_reactive_power
        - Voltage
        - Global_intensity
        - Sub_metering_1
        - Sub_metering_2
        - Sub_metering_3
        - hour_of_day
        - day_of_week
        - month
        - year
        train.models:
        - name: XGBoostRegressor
          file_name: xgb_model.pkl
          params:
            objective: reg:squarederror
            n_estimators: 1000
            learning_rate: 0.05
            max_depth: 6
            min_child_weight: 1
            gamma: 0.1
            reg_alpha: 0.005
            reg_lambda: 1
            subsample: 0.8
            colsample_bytree: 0.8
            random_state: 42
        - name: RandomForestRegressor
          file_name: rf_model.pkl
          params:
            n_estimators: 200
            max_depth: 15
            min_samples_split: 5
            min_samples_leaf: 2
            max_features: sqrt
            bootstrap: true
            oob_score: true
            random_state: 42
            n_jobs: -1
        - name: LightGBMRegressor
          file_name: lgbm_model.pkl
          params:
            boosting_type: gbdt
            objective: regression_l1
            n_estimators: 1000
            learning_rate: 0.05
            num_leaves: 31
            max_depth: -1
            reg_alpha: 0.1
            reg_lambda: 0.1
            colsample_bytree: 0.8
            subsample: 0.8
            random_state: 42
            n_jobs: -1
        validation:
          run_tcv: true
          tcv_splits: 5
          plots_dir: metrics/validation_plots
    outs:
    - path: models/rf_model.pkl
      hash: md5
      md5: cf2559ac5f728986d80d54c125b5e920
      size: 89605158
  train@2:
    cmd: python src/train.py --model-name "LightGBMRegressor"
    deps:
    - path: data/processed
      hash: md5
      md5: fbc47970798131997c5e76b2907928c8.dir
      size: 4935101
      nfiles: 4
    - path: src/train.py
      hash: md5
      md5: efd1a619ac59fbb1efe8a2a5b87cd117
      size: 4257
    params:
      params.yaml:
        train.features:
        - Global_reactive_power
        - Voltage
        - Global_intensity
        - Sub_metering_1
        - Sub_metering_2
        - Sub_metering_3
        - hour_of_day
        - day_of_week
        - month
        - year
        train.models:
        - name: XGBoostRegressor
          file_name: xgb_model.pkl
          params:
            objective: reg:squarederror
            n_estimators: 1000
            learning_rate: 0.05
            max_depth: 6
            min_child_weight: 1
            gamma: 0.1
            reg_alpha: 0.005
            reg_lambda: 1
            subsample: 0.8
            colsample_bytree: 0.8
            random_state: 42
        - name: RandomForestRegressor
          file_name: rf_model.pkl
          params:
            n_estimators: 200
            max_depth: 15
            min_samples_split: 5
            min_samples_leaf: 2
            max_features: sqrt
            bootstrap: true
            oob_score: true
            random_state: 42
            n_jobs: -1
        - name: LightGBMRegressor
          file_name: lgbm_model.pkl
          params:
            boosting_type: gbdt
            objective: regression_l1
            n_estimators: 1000
            learning_rate: 0.05
            num_leaves: 31
            max_depth: -1
            reg_alpha: 0.1
            reg_lambda: 0.1
            colsample_bytree: 0.8
            subsample: 0.8
            random_state: 42
            n_jobs: -1
        validation:
          run_tcv: true
          tcv_splits: 5
          plots_dir: metrics/validation_plots
    outs:
    - path: models/lgbm_model.pkl
      hash: md5
      md5: ad92eac4619bd03a7146b0a9b2f54780
      size: 2909006
  evaluate@0:
    cmd: python src/evaluate.py --model-name "XGBoostRegressor"
    deps:
    - path: data/processed
      hash: md5
      md5: fbc47970798131997c5e76b2907928c8.dir
      size: 4935101
      nfiles: 4
    - path: models/xgb_model.pkl
      hash: md5
      md5: 1f3fb066cbe1c95d90bc0946cb196aea
      size: 1003820
    - path: src/evaluate.py
      hash: md5
      md5: d289f55c889f8afca1da7015c9688caa
      size: 3212
    params:
      params.yaml:
        preprocess.target_column: Global_active_power
        train.models:
        - name: XGBoostRegressor
          file_name: xgb_model.pkl
          params:
            objective: reg:squarederror
            n_estimators: 1000
            learning_rate: 0.05
            max_depth: 6
            min_child_weight: 1
            gamma: 0.1
            reg_alpha: 0.005
            reg_lambda: 1
            subsample: 0.8
            colsample_bytree: 0.8
            random_state: 42
        - name: RandomForestRegressor
          file_name: rf_model.pkl
          params:
            n_estimators: 200
            max_depth: 15
            min_samples_split: 5
            min_samples_leaf: 2
            max_features: sqrt
            bootstrap: true
            oob_score: true
            random_state: 42
            n_jobs: -1
        - name: LightGBMRegressor
          file_name: lgbm_model.pkl
          params:
            boosting_type: gbdt
            objective: regression_l1
            n_estimators: 1000
            learning_rate: 0.05
            num_leaves: 31
            max_depth: -1
            reg_alpha: 0.1
            reg_lambda: 0.1
            colsample_bytree: 0.8
            subsample: 0.8
            random_state: 42
            n_jobs: -1
        validation:
          run_tcv: true
          tcv_splits: 5
          plots_dir: metrics/validation_plots
    outs:
    - path: metrics/XGBoostRegressor_metrics.json
      hash: md5
      md5: c7dee30601ad6926c8e9347e318a1409
      size: 109
    - path: metrics/validation_plots/XGBoostRegressor_residuals_histogram.png
      hash: md5
      md5: 96d77beb1fed4f901c2ae2bd75277f91
      size: 31112
    - path: metrics/validation_plots/XGBoostRegressor_residuals_over_time.png
      hash: md5
      md5: 8eed108725eb8b48dc61e96c71b6b2e2
      size: 123219
  evaluate@1:
    cmd: python src/evaluate.py --model-name "RandomForestRegressor"
    deps:
    - path: data/processed
      hash: md5
      md5: fbc47970798131997c5e76b2907928c8.dir
      size: 4935101
      nfiles: 4
    - path: models/rf_model.pkl
      hash: md5
      md5: cf2559ac5f728986d80d54c125b5e920
      size: 89605158
    - path: src/evaluate.py
      hash: md5
      md5: d289f55c889f8afca1da7015c9688caa
      size: 3212
    params:
      params.yaml:
        preprocess.target_column: Global_active_power
        train.models:
        - name: XGBoostRegressor
          file_name: xgb_model.pkl
          params:
            objective: reg:squarederror
            n_estimators: 1000
            learning_rate: 0.05
            max_depth: 6
            min_child_weight: 1
            gamma: 0.1
            reg_alpha: 0.005
            reg_lambda: 1
            subsample: 0.8
            colsample_bytree: 0.8
            random_state: 42
        - name: RandomForestRegressor
          file_name: rf_model.pkl
          params:
            n_estimators: 200
            max_depth: 15
            min_samples_split: 5
            min_samples_leaf: 2
            max_features: sqrt
            bootstrap: true
            oob_score: true
            random_state: 42
            n_jobs: -1
        - name: LightGBMRegressor
          file_name: lgbm_model.pkl
          params:
            boosting_type: gbdt
            objective: regression_l1
            n_estimators: 1000
            learning_rate: 0.05
            num_leaves: 31
            max_depth: -1
            reg_alpha: 0.1
            reg_lambda: 0.1
            colsample_bytree: 0.8
            subsample: 0.8
            random_state: 42
            n_jobs: -1
        validation:
          run_tcv: true
          tcv_splits: 5
          plots_dir: metrics/validation_plots
    outs:
    - path: metrics/RandomForestRegressor_metrics.json
      hash: md5
      md5: 8f1dcddc8d2ffb88ff45ab0901e53b87
      size: 107
    - path: 
        metrics/validation_plots/RandomForestRegressor_residuals_histogram.png
      hash: md5
      md5: a57006c21569ba5d8fe0e6af44e75bb3
      size: 31609
    - path: 
        metrics/validation_plots/RandomForestRegressor_residuals_over_time.png
      hash: md5
      md5: dac4b743e9ff6ba4b6a4a3c3f9200485
      size: 121761
  evaluate@2:
    cmd: python src/evaluate.py --model-name "LightGBMRegressor"
    deps:
    - path: data/processed
      hash: md5
      md5: fbc47970798131997c5e76b2907928c8.dir
      size: 4935101
      nfiles: 4
    - path: models/lgbm_model.pkl
      hash: md5
      md5: ad92eac4619bd03a7146b0a9b2f54780
      size: 2909006
    - path: src/evaluate.py
      hash: md5
      md5: d289f55c889f8afca1da7015c9688caa
      size: 3212
    params:
      params.yaml:
        preprocess.target_column: Global_active_power
        train.models:
        - name: XGBoostRegressor
          file_name: xgb_model.pkl
          params:
            objective: reg:squarederror
            n_estimators: 1000
            learning_rate: 0.05
            max_depth: 6
            min_child_weight: 1
            gamma: 0.1
            reg_alpha: 0.005
            reg_lambda: 1
            subsample: 0.8
            colsample_bytree: 0.8
            random_state: 42
        - name: RandomForestRegressor
          file_name: rf_model.pkl
          params:
            n_estimators: 200
            max_depth: 15
            min_samples_split: 5
            min_samples_leaf: 2
            max_features: sqrt
            bootstrap: true
            oob_score: true
            random_state: 42
            n_jobs: -1
        - name: LightGBMRegressor
          file_name: lgbm_model.pkl
          params:
            boosting_type: gbdt
            objective: regression_l1
            n_estimators: 1000
            learning_rate: 0.05
            num_leaves: 31
            max_depth: -1
            reg_alpha: 0.1
            reg_lambda: 0.1
            colsample_bytree: 0.8
            subsample: 0.8
            random_state: 42
            n_jobs: -1
        validation:
          run_tcv: true
          tcv_splits: 5
          plots_dir: metrics/validation_plots
    outs:
    - path: metrics/LightGBMRegressor_metrics.json
      hash: md5
      md5: 4873f14b81971eb7147aa3181c574c7a
      size: 108
    - path: metrics/validation_plots/LightGBMRegressor_residuals_histogram.png
      hash: md5
      md5: 70e7e78e5f8e44a84df86a2c23195203
      size: 28899
    - path: metrics/validation_plots/LightGBMRegressor_residuals_over_time.png
      hash: md5
      md5: 4870283cb92e0fa4ef963aeba1702394
      size: 97907
