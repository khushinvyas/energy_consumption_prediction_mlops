schema: '2.0'
stages:
  preprocess:
    cmd: python src/data_preprocessing.py
    deps:
    - path: data/raw/household_power_consumption.txt
      hash: md5
      md5: e05286cd4a257d80c3f0407b350df7dd
      size: 132960755
    - path: src/data_preprocessing.py
      hash: md5
      md5: 0dcea15c1dfd019850eb352da34085f6
      size: 4229
    params:
      params.yaml:
        base:
          project_name: energy_consumption_prediction
          random_state: 42
        data:
          raw_data_dir: data/raw
          raw_data_file: household_power_consumption.txt
          processed_data_dir: data/processed
          cleaned_file: cleaned_data.csv
          train_file: train.csv
          test_file: test.csv
        preprocessing:
          separator: ;
          missing_value_char: '?'
          target_col: Global_active_power
          imputation_method: ffill
    outs:
    - path: data/processed/cleaned_data.csv
      hash: md5
      md5: a65140f8a2704a77015b0d5cc16bf05e
      size: 115279892
  split:
    cmd: python src/data_split.py
    deps:
    - path: data/processed/cleaned_data.csv
      hash: md5
      md5: a65140f8a2704a77015b0d5cc16bf05e
      size: 115279892
    - path: src/data_split.py
      hash: md5
      md5: 1f31c47747187b3b3b2afb250f6e5f5f
      size: 3067
    params:
      params.yaml:
        base:
          project_name: energy_consumption_prediction
          random_state: 42
        data:
          raw_data_dir: data/raw
          raw_data_file: household_power_consumption.txt
          processed_data_dir: data/processed
          cleaned_file: cleaned_data.csv
          train_file: train.csv
          test_file: test.csv
        data_split:
          test_split_ratio: 0.2
        featurization:
          features_to_use:
          - Global_reactive_power
          - Voltage
          - Global_intensity
          - Sub_metering_1
          - Sub_metering_2
          - Sub_metering_3
        preprocessing:
          separator: ;
          missing_value_char: '?'
          target_col: Global_active_power
          imputation_method: ffill
    outs:
    - path: data/processed/test.csv
      hash: md5
      md5: be211a85e7a466889ad83a8bc432fc12
      size: 23055908
    - path: data/processed/train.csv
      hash: md5
      md5: e30b66abcdd7571113dfeaee7cc09529
      size: 92224106
  train_model:
    cmd: python src/train.py
    deps:
    - path: data/processed/train.csv
      hash: md5
      md5: d6efe250686db1a2d1071b65fc978c0d
      size: 92243702
    - path: src/train.py
      hash: md5
      md5: c7df8b34f7170f72dde8cfff32fa5f6d
      size: 4373
    params:
      params.yaml:
        base:
          project_name: energy_consumption_prediction
          random_state: 42
        data:
          raw_data_dir: data/raw
          raw_data_file: household_power_consumption.txt
          processed_data_dir: data/processed
          cleaned_file: cleaned_data.csv
          train_file: train.csv
          test_file: test.csv
        featurization:
          features_to_use:
          - Global_reactive_power
          - Voltage
          - Global_intensity
          - Sub_metering_1
          - Sub_metering_2
          - Sub_metering_3
        model:
          model_name: XGBoostRegressor
          n_estimators: 100
          max_depth: 6
          learning_rate: 0.1
          min_child_weight: 1
          subsample: 0.8
          colsample_bytree: 0.8
        preprocessing:
          separator: ;
          missing_value_char: '?'
          target_col: Global_active_power
          imputation_method: bfill
        tuning:
          cv_folds: 5
          n_iter: 100
          param_distributions:
            model.n_estimators:
            - 100
            - 200
            - 300
            - 400
            - 500
            model.max_depth:
            - 4
            - 6
            - 8
            - 10
            - 12
            model.learning_rate:
            - 0.01
            - 0.05
            - 0.1
            - 0.2
            - 0.3
            model.min_child_weight:
            - 1
            - 5
            - 10
            model.subsample:
            - 0.6
            - 0.7
            - 0.8
            - 0.9
            - 1.0
            model.colsample_bytree:
            - 0.6
            - 0.7
            - 0.8
            - 0.9
            - 1.0
            model.reg_alpha:
            - 0
            - 0.01
            - 0.1
            - 1
            model.reg_lambda:
            - 1
            - 1.5
            - 2
            - 3
            - 4
            model.gamma:
            - 0
            - 0.1
            - 0.2
            - 0.3
            - 0.4
    outs:
    - path: models/model.joblib
      hash: md5
      md5: 20247991fc54326d9b0351f5c1f608c3
      size: 498558
  evaluate_model:
    cmd: python src/evaluate.py
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 9e2bf364f1f516d8d4ed9fe89ca6f5a1
      size: 23060884
    - path: models/model.joblib
      hash: md5
      md5: 20247991fc54326d9b0351f5c1f608c3
      size: 498558
    - path: src/evaluate.py
      hash: md5
      md5: 928231352f9f1ff78b41e4165b989f71
      size: 3875
    params:
      params.yaml:
        base:
          project_name: energy_consumption_prediction
          random_state: 42
        data:
          raw_data_dir: data/raw
          raw_data_file: household_power_consumption.txt
          processed_data_dir: data/processed
          cleaned_file: cleaned_data.csv
          train_file: train.csv
          test_file: test.csv
        featurization:
          features_to_use:
          - Global_reactive_power
          - Voltage
          - Global_intensity
          - Sub_metering_1
          - Sub_metering_2
          - Sub_metering_3
        preprocessing:
          separator: ;
          missing_value_char: '?'
          target_col: Global_active_power
          imputation_method: bfill
    outs:
    - path: reports/metrics.json
      hash: md5
      md5: 212a0b1faa16f0b1307e43d1e5e43b1b
      size: 166
